<!DOCTYPE html>
<html style="height: 100%">
   <head>
       <meta charset="utf-8">
       <script type="text/javascript" src="../../ext4/ext-all-debug.js"></script>
       <script type="text/javascript" src="../common/common.js"></script>
       <link rel="stylesheet" type="text/css" href="../../ext4/resources/css/ext-all.css">
   </head>
   <body style="height: 100%; margin: 0">
       <div id="container" style="height: 100%"></div>
       <script type="text/javascript" src="echarts-all-3.js"></script>
	   <script type="text/javascript" src="china.js"></script>
        <script src="../../bootstrap/assets/js/jquery-1.10.2.js" type="text/javascript"></script>
       <script type="text/javascript">
var dom = document.getElementById("container");
var myChart = echarts.init(dom);
//注册事件
myChart.on('click', function (params) {
//  console.log(params);
  var scatter_param = params.data.value;
  if(params.componentSubType == 'effectScatter' ){

        var win = Ext.create('Ext.window.Window', {
            title: params.data.value[6],
            autoShow: true, //自动打开
            modal: true, //模态窗口
            width: 580, //窗体宽度
            autoScroll: true, //是否添加滚动条
            resizable: false,
            constrain: true, //是否限制窗口超出浏览器
            plain: true, //是否设置窗口透明背景
            items: [
              {
                  xtype: 'form',
                  layout: 'column',
                  defaultType: 'textfield',
                  defaults: {
                      labelWidth: 90,
                      labelAlign: 'right',
                      columnWidth: 0.49,
                      padding: '15 15 10 10',
                      allowBlank: true,
                      minLength: 0,
                      maxLength: 160
                  },

                  items: [{
                      xtype: 'hiddenfield',
                      name: 'senid',
                      value: '0'
                  }, {
                      xtype: 'combo',
                      name: 'devtypeid',
                      fieldLabel: '设备型号',
                      selectOnFocus: false,
                      editable: false,
                      columnWidth: 1,
                      allowBlank: false,
                      blankText: '不能为空',
                      queryMode: 'local',
                      forceSelection:true,
                      store: Ext.create('Ext.data.Store', {
                        fields: [  {name: 'text'},{name: 'value'}],
                        pageSize: 100,
                        proxy: {
                          type: 'ajax',
                          url: '/gh/sys/user/gh10_sensortl_list_l.action',
                          actionMethods: {create: "POST", read: "POST", update: "POST", destroy: "POST"},
                          reader: {type: 'json',root: 'rows',totalProperty: 'total'},
                          writer: {type: 'json'}
                      },
                      //autoLoad:true
                    }),
                      valueField: 'value',
                      displayField: 'text',
                      listConfig: {
                          getInnerTpl: function() {
                              return '<div>{value}-{text}</div>';
                          }
                      },
                      listeners : {
                          change:function (c,nv,ov,opts) {
                            var myform = c.up('form');
                            var isrs =  c.rawValue;
                            isrs = isrs.substring(isrs.lastIndexOf('-')+1,isrs.length);
                            var ipparam = myform.down('textfield[name=ipparam]');
                            var gwid = myform.down('combo[name=gwid]');
                            var devaddr = myform.down('combo[name=devaddr]');
                            if(isrs == '0'){
                              ipparam.show();
                              gwid.hide();
                              devaddr.hide();
                              ipparam.allowBlank = false;
                              gwid.allowBlank = true;
                              devaddr.allowBlank = true;
                            }
                            else{
                              ipparam.hide();
                              gwid.show();
                              devaddr.show(true);
                              ipparam.allowBlank = true;
                              gwid.allowBlank = false;
                              devaddr.allowBlank = false;
                            }
                          }
                      }
                  }, {
                      xtype: 'combo',
                      name: 'compid',
                      fieldLabel: '所属企业',
                      selectOnFocus: false,
                      editable: false,
                      allowBlank: false,
                      columnWidth: 1,
                      emptyText: '请输入企业名称',
                      blankText: '企业名称不能为空',
                      queryMode: 'local',
                      store: Ext.create('Ext.data.Store', {
                        fields: [  {name: 'compid'},{name: 'compname'}],
                        pageSize: 100,
                        proxy: {
                          type: 'ajax',
                          url: '/gh/sp/spinfo/as10_sp_spinfo_list_l.action',
                          actionMethods: {create: "POST", read: "POST", update: "POST", destroy: "POST"},
                          reader: {type: 'json',root: 'rows',totalProperty: 'total'},
                          writer: {type: 'json'}
                      },
                      //autoLoad:true
                    }),
                      valueField: 'compid',
                      displayField: 'compname'
                  }, {
                      xtype: 'combo',
                      name: 'gwid',
                      fieldLabel: '网关',
                      selectOnFocus: false,
                      editable: false,
                      columnWidth: 1,
                      allowBlank: false,
                      blankText: '不能为空',
                      hidden:false,
                      queryMode: 'local',
                      store: Ext.create('Ext.data.Store', {
                        fields: [  {name: 'value'},{name: 'text'}],
                        pageSize: 100,
                        proxy: {
                          type: 'ajax',
                          extraParams:{
                            params: Ext.encode({
                                keyword: ''
                            })
                                  },
                          url: '/gh/sys/user/gh10_gateway_list_l.action',
                          actionMethods: {create: "POST", read: "POST", update: "POST", destroy: "POST"},
                          reader: {type: 'json',root: 'rows',totalProperty: 'total'},
                          writer: {type: 'json'}
                      },
                      //autoLoad:true
                    }),
                      valueField: 'value',
                      displayField: 'text',
                      listConfig: {
                          getInnerTpl: function() {
                              return '<div>{value} -- {text}</div>';
                          }
                      },
                      listeners : {
                          change:function(c,nv,ov,opts) {
                            var comb = c.up('form').down('combo[name=devaddr]');
                            if(comb.cflag === 1){
                               comb.setValue(null);
                            }
                            if(c.isValid())
                            {
                                comb.setReadOnly(false) ;
                                comb.getStore().proxy.extraParams = {gwid:nv };
                                comb.getStore().load();
                            }
                          }
                      }

                  }, {
            				name : 'sn',
            				fieldLabel : '设备名称',
            				emptyText : '请输入设备名称',
            				blankText : '设备名称不能为空',
                    columnWidth: 1,
                      allowBlank: false,
            				maxLength : 128
            			}, {
                      xtype: 'combo',
                      name: 'devaddr',
                      editable: false,
                      readOnly:true,
                      fieldLabel: '设备地址',
                      store: Ext.create('Ext.data.Store', {
                        fields: [  {name: 'text'},{name: 'text'}],
                        pageSize: 100,
                        proxy: {
                          type: 'ajax',
                          extraParams : {gwid:0},
                          url: '/gh/sys/product/searchdevaddr.action',
                          actionMethods: {create: "POST", read: "POST", update: "POST", destroy: "POST"},
                          reader: {type: 'json',root: 'rows',totalProperty: 'total'},
                          writer: {type: 'json'}
                      },
                      //autoLoad:true
                    }),
                      queryMode: 'local',
                      allowBlank: false,
                      cflag:1,
                      displayField: 'text',
                      hidden:false,
                      valueField: 'text',
                  }, {
                    name : 'ipparam',
                    fieldLabel : '扩展参数',
                    emptyText : 'ip;port;user;password',
                    blankText : '不能为空',
                    allowBlank: false,
                    regex:/(.*);(.*);(.*);(.*)/,
                    columnWidth: 1,
                    regexText:'请输入正确格式',
                    hidden:true,
                    maxLength : 64
                  }, {
                      xtype: 'numberfield',
                      name: 'x',
                      minValue: 1,
                      value: 1,
                      step: 1,
                      fieldLabel: '<span class="form_require_symbol">*</span>x',
                      allowBlank: false,
                  }, {
                      xtype: 'numberfield',
                      name: 'y',
                      minValue: 1,
                      value: 1,
                      step: 1,
                      fieldLabel: '<span class="form_require_symbol">*</span>y',
                      allowBlank: false,
                  }, {
                      xtype: 'numberfield',
                      name: 'z',
                      minValue: 1,
                      value: 1,
                      step: 1,
                      fieldLabel: '<span class="form_require_symbol">*</span>z',
                      allowBlank: false,
                  }, {
                      name: 'useflag',
                      fieldLabel: '启用标志',
                      xtype: 'combo',
                      queryMode: 'local',
                      editable: false,
                      selectOnFocus: false,
                      valueField: 'value',
                      displayField: 'text',
                      value: 1,
                      store: Ext.create('Ext.data.Store', {
                        fields: ['value', 'text'],
                        data: [
                            {"value": 1, "text": '启用'},
                            {"value": 0, "text": '禁用'}
                        ],
                    })
                  }],
                  buttonAlign: 'center',
                  buttons : [ {
                		text : '  确  定  ',
                		disabled : false,
                		//formBind : true,
                		//listeners : {
                		//	click : '_onAddsensor'
                		//}
                    handler : function(btn){
                			//btn.up('window').down('form').reset();

                    	var win = btn.up('window');
                    	var form = win.down('form');
                      var devtpid = form.down('combo[name=devtypeid]').rawValue;




                    	if(form.isValid()){
                    		var formParams = form.getValues();
                        var isrs = devtpid.substring(devtpid.lastIndexOf('-')+1,devtpid.length);
                    		var params = {};

                        params.devtypeid = formParams.devtypeid;
                    		params.compid = formParams.compid;
                    		params.gwid = formParams.gwid;
                        params.devaddr = formParams.devaddr;
                    		params.x = formParams.x;
                    		params.y = formParams.y;
                    		params.z = formParams.z;
                    		params.useflag = formParams.useflag;
                        params.sn = formParams.sn;
                        params.isrs = isrs;
                        params.ipparam = formParams.ipparam;




                        var url ='/gh/sys/user/gh10_sensor_add_c.action';
                        if(formParams.senid != '0')
                        {
                          params.senid = formParams.senid;
                          url = '/gh/sys/user/gh10_sensor_upd_d.action';

                        }
                    		just.showWaitingDlg("请稍候...");
                    		Ext.Ajax.request({
                    			url: url,
                    			params: {params: Ext.encode(params)},
                    			success: function(response, options){
                    				var jsonObj = Ext.JSON.decode(response.responseText);
                    				just.hideWaitingDlg(jsonObj.info,true);
                    				if(jsonObj.status == '200'){
                    					win.close();
                              drowmap();
                    				}
                    			}
                    		});
                    	}
                      else{
                        Ext.Msg.alert('系统提示','参数不全！');
                      }
                		}

                	} ],
              }
            ]
        });


        win.down('combo[name=devaddr]').cflag = 0;
        var senid = win.down('hiddenfield');
        var dev_combo = win.down('combo[name=devtypeid]');
        var corpid_combo = win.down('combo[name=compid]');
        var gateway_combo = win.down('combo[name=gwid]');
        var sn = win.down('textfield[name=sn]');
        var devaddr = win.down('combo[name=devaddr]');
        var ipparam = win.down('textfield[name=ipparam]');
        var x = win.down('numberfield[name=x]');
        var y = win.down('numberfield[name=y]');
        var z = win.down('numberfield[name=z]');
        var useflag = win.down('combo[name=useflag]');

        var _store  = corpid_combo.getStore();
        _store.load();

        var _gwstore  = gateway_combo.getStore();
        _gwstore.load();

        var _devstore  = dev_combo.getStore();
        _devstore.load();
        if(scatter_param.length > 4){
          win.setTitle('修改传感器【'+scatter_param[6]+'】属性');
          senid.setValue(scatter_param[5]);
          dev_combo.setValue(scatter_param[3]);
          corpid_combo.setValue(scatter_param[10]);
          gateway_combo.setValue(scatter_param[4]);
          sn.setValue(scatter_param[6]);
          devaddr.setValue(scatter_param[2]);
          ipparam.setValue(scatter_param[11]);
          x.setValue(scatter_param[12]);
          y.setValue(scatter_param[13]);
          z.setValue(scatter_param[14]);
          useflag.setValue(scatter_param[7]);
        }
        else if (scatter_param.length == 4) {
          win.setTitle('给网关（'+scatter_param[3]+')添加传感器');
          gateway_combo.setValue(scatter_param[2]);
        }

        //  win.down('form').loadRecord(record);


  }


});
var app = {};
option = null;
var convertData = function (makerarrey) {
  var res = [];
    var gateway1 = [];
    var gateway2 = [];
    var fgwid = makerarrey[0]['gwid'];
    makerarrey.forEach(function(marker) {
      if(marker['gwid'] == fgwid)
      {
        gateway1.push([marker['devaddr']].concat(marker['devtypeid']).concat(marker['gwid']).concat(marker['senid']).concat(marker['sn']).concat(marker['useflag']).concat(marker['devname']).concat(marker['devtype']).concat(marker['compid']).concat(marker['ipparam']).concat(marker['x']).concat(marker['y']).concat(marker['z']).concat(marker['dispname']));
      }
      else{
        gateway2.push([marker['devaddr']].concat(marker['devtypeid']).concat(marker['gwid']).concat(marker['senid']).concat(marker['sn']).concat(marker['useflag']).concat(marker['devname']).concat(marker['devtype']).concat(marker['compid']).concat(marker['ipparam']).concat(marker['x']).concat(marker['y']).concat(marker['z']).concat(marker['dispname']));
      }
   });
   res.push({
        gateway1:gateway1,
        gateway2: gateway2,
    });
   return res;
};
var svgpath = [
   'path://M890.679575 770.370489l18.273179 0 0 18.273179-18.273179 0 0-18.273179Z" p-id="6138"></path><path d="M976.098014 660.890029 47.562249 660.890029c-11.846816 0-21.449521 9.603729-21.449521 21.449521l0 194.335057c0 11.846816 9.602705 21.449521 21.449521 21.449521l928.535765 0c11.845793 0 21.449521-9.603729 21.449521-21.449521L997.547535 682.33955C997.547535 670.493757 987.944829 660.890029 976.098014 660.890029zM707.937554 806.91787l-54.821583 0 0-54.82056 54.821583 0L707.937554 806.91787zM817.585837 806.91787l-54.826699 0 0-54.82056 54.826699 0L817.585837 806.91787zM927.226956 806.91787l-54.82056 0 0-54.82056 54.82056 0L927.226956 806.91787z" p-id="6139"></path><path d="M650.785903 312.769446l12.323677 0c0-60.026118-48.835242-108.86136-108.86136-108.86136l0 12.323677C607.479585 216.231763 650.785903 259.538081 650.785903 312.769446z" p-id="6140"></path><path d="M702.730972 312.769446l18.954701 0c0-92.324732-75.111698-167.437453-167.437453-167.437453l0 18.954701C636.121925 164.286694 702.730972 230.996764 702.730972 312.769446z" p-id="6141"></path><path d="M769.527285 312.769446l27.481911 0c0-133.857661-108.902292-242.759953-242.759953-242.759953l0 27.481911C672.953785 97.491405 769.527285 194.064904 769.527285 312.769446z" p-id="6142"></path><path d="M978.87015 614.20373l-64.915475-194.335057c-2.923586-8.752338-11.117199-14.653745-20.344351-14.653745L602.771353 405.214928l0 78.901001c0 11.396561-9.324366 20.720927-20.720927 20.720927l-7.081279 0c-11.396561 0-20.720927-9.324366-20.720927-20.720927l0-78.901001L201.836915 405.214928l0 78.901001c0 11.396561-9.324366 20.720927-20.720927 20.720927l-7.081279 0c-11.396561 0-20.720927-9.324366-20.720927-20.720927l0-78.901001-33.441647 0c-9.257851 0-17.470907 5.939269-20.369933 14.731516L35.404348 614.281501c-4.577249 13.877055 5.758144 28.16855 20.369933 28.16855l902.750495 0C973.171358 642.449028 983.50982 628.096135 978.87015 614.20373z" p-id="6143"></path><path d="M195.552791 167.328983c0-10.091846-8.181333-18.274202-18.274202-18.274202l0 0c-10.091846 0-18.274202 8.181333-18.274202 18.274202l0 234.891751 0 2.994194 0 75.574233c0 10.091846 8.181333 18.274202 18.274202 18.274202l0 0c10.091846 0 18.274202-8.181333 18.274202-18.274202l0-75.574233 0-2.994194L195.552791 167.328983z" p-id="6144"></path><path d="M578.077951 300.022121c-10.093892 0-18.276249 8.182356-18.276249 18.276249l0 83.922365 0 2.994194 0 75.735915c0 10.093892 8.182356 18.276249 18.276249 18.276249s18.276249-8.182356 18.276249-18.276249l0-75.735915 0-2.994194 0-83.922365C596.3542 308.204477 588.171843 300.022121 578.077951 300.022121z'
  ,'path://M1023.148-150.803h-1022.282c-82.786 0-149.908 67.122-149.908 149.908v1025.807c0 82.786 67.122 149.908 149.908 149.908h1022.282c82.786 0 149.908-67.122 149.908-149.908v-1025.809c-0.016-82.786-67.122-149.908-149.908-149.908zM1063.118 1024.895c0 22.039-17.93 39.969-39.969 39.969h-1022.282c-22.039 0-39.969-17.93-39.969-39.969v-1025.809c0-22.039 17.93-39.969 39.969-39.969h1022.282c22.039 0 39.969 17.93 39.969 26.164v1039.612z M14.897 183.167h236.869c73.571 0 116.57 17.481 153.19 52.527s54.93 84.756 54.93 149.38c0 66.363-19.967 118.31-59.901 155.677-39.851 37.283-89.562 56.007-171.501 56.007h-75.891v244.078h-137.697v-657.667zM152.594 463.533h49.793c39.105 0 66.778-6.877 82.519-20.382 15.824-13.587 23.778-31.069 23.778-52.278 0-20.629-6.877-38.112-20.629-52.527s-39.601-21.54-77.631-21.54h-57.829v146.727z M513.823 183.167h141.757v248.551h222.123v-248.551h131.401v657.749h-131.484v-266.116h-222.039v266.033h-141.757v-657.667z'
  ,'path://M234.048 508.864c0-153.472 124.416-277.888 277.888-277.888 153.472 0 277.888 124.416 277.888 277.888S665.408 786.752 512 786.752C358.464 786.752 234.048 662.4 234.048 508.864" p-id="1636"></path><path d="M489.024 0l45.952 0 0 160.896-45.952 0 0-160.896Z" p-id="1637"></path><path d="M489.024 863.04l45.952 0 0 160.96-45.952 0 0-160.96Z" p-id="1638"></path><path d="M863.04 485.888l160.96 0 0 45.952-160.96 0 0-45.952Z" p-id="1639"></path><path d="M0 485.888l160.896 0 0 45.952-160.896 0 0-45.952Z" p-id="1640"></path><path d="M692.129536 222.811629l-39.72983-22.957766 80.46425-139.248346 39.72983 22.957766-80.46425 139.248346Z" p-id="1641"></path><path d="M301.227955 808.036186l39.780646 22.998976-80.528448 139.287667-39.780646-22.998976 80.528448-139.287667Z" p-id="1642"></path><path d="M275.875245 57.148346l80.399917 139.296595-39.799027 22.971405-80.399917-139.296595 39.799027-22.971405Z" p-id="1643"></path><path d="M707.41913 804.533523l80.431712 139.423552-39.803622 22.962214-80.431712-139.423552 39.803622-22.962214Z" p-id="1644"></path><path d="M196.452691 356.32231l-139.264429-80.46425 22.989786-39.789837 139.264429 80.46425-22.989786 39.789837Z" p-id="1645"></path><path d="M943.832832 787.962112l-139.335936-80.448 23.008-39.849856 139.335936 80.448-23.008 39.849856Z" p-id="1646"></path><path d="M196.477862 667.659533l22.989594 39.859059-139.312678 80.351667-22.989594-39.859059 139.312678-80.351667Z" p-id="1647"></path><path d="M827.667021 356.575616l-23.044928-39.753075 139.246496-80.72144 23.044928 39.753075-139.246496 80.72144Z'
  ,'path://M550.820983 617.907039l-9.138563-4.043277L541.68242 273.878529c0-14.228732-18.134879-26.249063-39.598733-26.249063-21.4659 0-39.599756 12.021355-39.599756 26.249063l0 339.986257-9.138563 4.043277c-43.64201 19.312761-71.840564 62.615017-71.840564 110.3177 0 66.488416 54.09149 120.579907 120.578883 120.579907 66.488416 0 120.579907-54.09149 120.579907-120.579907C622.664617 680.522055 594.464016 637.2198 550.820983 617.907039z M674.39318 545.595731l-4.821027-4.544721L669.572154 175.275177c0-35.766267-18.652697-70.39968-51.175951-95.021608-31.302391-23.697838-72.610128-36.748688-116.312515-36.748688-43.703411 0-85.011147 13.05085-116.314562 36.748688-32.522231 24.620905-51.174928 59.254318-51.174928 95.021608l0 365.776857-4.820003 4.544721C279.71063 592.79083 250.998351 659.357021 250.998351 728.225762c0 67.067635 26.11705 130.120648 73.541381 177.544979 47.424331 47.424331 110.478367 73.541381 177.544979 73.541381 67.067635 0 130.121671-26.11705 177.546002-73.541381s73.541381-110.477343 73.541381-177.544979C753.172094 659.357021 724.457768 592.79083 674.39318 545.595731zM502.083687 938.378933c-115.877589 0-210.152148-94.273536-210.152148-210.152148 0-62.79308 27.768746-121.80998 76.185731-161.918343l7.410116-6.138085 0-384.894157c0-24.671049 14.479454-48.65031 39.726652-65.787418 23.79608-16.15264 54.631822-25.048667 86.828626-25.048667 32.195781 0 63.032545 8.896028 86.827603 25.048667 25.246175 17.138131 39.726652 41.116369 39.726652 65.787418l0 384.893133 7.409092 6.138085c48.419032 40.109387 76.189824 99.126286 76.189824 161.919367C712.237882 844.104374 617.963323 938.378933 502.083687 938.378933z M717.924667 201.768822l39.045098 0c8.858163 0 16.038024-5.821868 16.038024-13.004799s-7.179861-13.004799-16.038024-13.004799l-39.045098 0c-8.856117 0-16.035977 5.821868-16.035977 13.004799S709.067527 201.768822 717.924667 201.768822z'
  ,'path://M363.648 52.928C244.416 385.792 0 526.016 0 703.104 0 880.384 162.816 1024 363.648 1024s363.584-143.616 363.584-320.896C727.168 526.016 401.088 59.776 363.648 52.928M1020.608 243.392C1002.88 169.408 819.904 0 803.52 0c-16.448 148.352-104.576 226.048-86.784 300.096s100.16 121.344 184.128 105.728C984.704 390.208 1038.4 317.504 1020.608 243.392'
  ,'path://M875.336122 166.112272c0-33.668821-37.369096-58.598606-114.242927-76.214822-63.414285-14.532995-147.364279-22.536272-236.387825-22.536272s-172.97354 8.003278-236.387825 22.536272c-76.873832 17.616216-114.241904 42.547025-114.241904 76.214822 0 2.00261 0.14224 3.972475 0.406253 5.913687-0.25378 1.39579-0.406253 2.828418-0.406253 4.297886l0 687.562505c0 3.40761 0.725524 6.642281 2.012843 9.575076 8.65717 27.191292 45.589314 47.964408 112.229061 63.235207 63.413262 14.532995 147.364279 22.536272 236.387825 22.536272s172.97354-8.003278 236.387825-22.536272c66.639746-15.271822 103.57189-36.043914 112.230084-63.235207 1.287319-2.932796 2.012843-6.167466 2.012843-9.576099L875.336122 176.323844c0-1.469468-0.152473-2.902096-0.406253-4.297886C875.193883 170.084747 875.336122 168.114882 875.336122 166.112272zM311.581388 133.693932c58.428737-11.992125 134.11758-18.596544 213.123982-18.596544 79.006402 0 154.695245 6.604418 213.123982 18.596544 59.029418 12.115945 82.312704 25.988908 88.562035 32.41834-6.249331 6.429433-29.531594 20.302395-88.563058 32.41834-58.428737 11.992125-134.116557 18.596544-213.122959 18.596544s-154.695245-6.604418-213.123982-18.596544c-59.030441-12.115945-82.312704-25.988908-88.562035-32.41834C229.269707 159.682839 252.55197 145.809877 311.581388 133.693932zM827.599911 859.045087c-3.849678 5.557576-25.847691 20.736277-89.77056 33.856086-58.429761 11.992125-134.11758 18.596544-213.123982 18.596544-79.006402 0-154.695245-6.604418-213.123982-18.596544-63.921845-13.119809-85.919858-28.297486-89.769536-33.856086L221.811852 220.966601c17.35425 8.064676 39.47813 15.166421 66.506716 21.360494 63.414285 14.531971 147.365302 22.536272 236.387825 22.536272 89.022523 0 172.97354-8.003278 236.387825-22.536272 27.028587-6.194072 49.152467-13.296841 66.506716-21.361517L827.600935 859.045087z M524.709463 633.511471c60.562331 0 109.832478-49.272193 109.832478-109.836571 0-19.932981-5.40408-39.46892-15.627932-56.495712l-0.011256 0.007163c-4.242627-8.022721-27.149337-50.136887-74.749448-117.003807-0.008186-0.011256-0.016373-0.020466-0.024559-0.030699-0.385786-0.539282-0.805342-1.057075-1.239224-1.567705-0.096191-0.112564-0.183172-0.236384-0.280386-0.347924-0.267083-0.302899-0.563842-0.584308-0.849344-0.87595-0.289596-0.296759-0.569982-0.604774-0.871857-0.884137-0.104377-0.096191-0.222057-0.182149-0.328481-0.276293-0.50449-0.449231-1.017166-0.884137-1.552356-1.284249-0.010233-0.008186-0.019443-0.017396-0.029676-0.024559-0.085958-0.064468-0.178055-0.11461-0.264013-0.177032-0.546446-0.396019-1.101077-0.775666-1.674129-1.121544-0.229221-0.13917-0.466628-0.254803-0.698918-0.384763-0.440022-0.245593-0.877997-0.49221-1.330298-0.708128-0.357134-0.171915-0.722454-0.314155-1.085728-0.466628-0.338714-0.141216-0.673335-0.291642-1.01819-0.417509-0.434905-0.159636-0.87595-0.289596-1.316995-0.421602-0.289596-0.086981-0.576121-0.183172-0.868787-0.258896-0.459464-0.119727-0.921999-0.210801-1.38658-0.301875-0.291642-0.057305-0.581238-0.122797-0.873903-0.169869-0.438998-0.069585-0.880043-0.113587-1.321088-0.157589-0.332575-0.033769-0.664126-0.074701-0.997724-0.095167-0.388856-0.022513-0.777713-0.023536-1.166569-0.027629-0.391926-0.005117-0.782829-0.013303-1.174756 0.001023-0.332575 0.013303-0.663102 0.046049-0.994654 0.072655-0.444115 0.034792-0.886183 0.068562-1.329275 0.128937-0.291642 0.039909-0.580215 0.098237-0.870834 0.149403-0.468674 0.081864-0.936325 0.162706-1.400906 0.273223-0.289596 0.068562-0.573051 0.156566-0.859577 0.23536-0.448208 0.12382-0.896416 0.245593-1.339508 0.397043-0.340761 0.115634-0.673335 0.255827-1.00898 0.387833-0.372483 0.146333-0.74599 0.283456-1.113357 0.450255-0.447185 0.201591-0.881067 0.433882-1.315972 0.664126-0.245593 0.12996-0.49528 0.245593-0.737804 0.384763-0.568958 0.326435-1.12052 0.686638-1.663896 1.062192-0.098237 0.067538-0.200568 0.12075-0.297782 0.190335-0.01228 0.008186-0.022513 0.01842-0.033769 0.026606-0.532119 0.38067-1.043772 0.796132-1.547239 1.223874-0.118704 0.101307-0.249687 0.192382-0.366344 0.294712-0.298805 0.264013-0.578168 0.557702-0.865717 0.839111-0.299829 0.292666-0.610914 0.576121-0.892323 0.881067-0.095167 0.103354-0.181125 0.220011-0.275269 0.326435-0.449231 0.50449-0.88516 1.01819-1.285273 1.554402-0.008186 0.010233-0.017396 0.019443-0.024559 0.029676-49.686632 66.627467-71.191412 109.22054-75.466786 118.105908-9.963932 16.864086-15.236006 36.141128-15.236006 55.813167C414.872892 584.238254 464.145086 633.511471 524.709463 633.511471zM470.885604 492.692259c0.688685-1.036609 1.309832-2.13564 1.843998-3.303232 0.160659-0.350994 14.360056-31.005155 51.606355-84.133166 36.313044 53.358255 52.652174 84.777849 52.837392 85.138052 0.396019 0.769526 0.840134 1.49812 1.304715 2.205225 5.447059 9.407254 8.328689 20.126386 8.328689 31.074739 0 34.242895-27.857465 62.10036-62.09729 62.10036-34.242895 0-62.10036-27.858488-62.10036-62.10036C462.60808 512.75827 465.472314 502.072907 470.885604 492.692259z M749.2034 708.954721c-12.32777-4.65809-26.103518 1.558495-30.764678 13.889335-7.801686 20.644179-27.876907 34.515095-49.953715 34.515095-19.386536 0-37.22481-10.69355-46.569642-27.272133-0.465604-9.188266-6.240121-17.673521-15.396665-21.132296-3.094478-1.169639-6.28003-1.65264-9.388834-1.526773-3.102664-0.122797-6.281053 0.361227-9.367345 1.526773-9.156544 3.459798-14.931061 11.9471-15.395642 21.135366-9.343809 16.57756-27.181059 27.269064-46.563502 27.269064-22.078855 0-42.157145-13.870916-49.960879-34.517141-3.615341-9.562796-12.713556-15.418154-22.367427-15.404852-9.733689-0.102331-18.940374 5.77247-22.581298 15.406898-7.801686 20.644179-27.877931 34.515095-49.956785 34.515095s-42.155099-13.870916-49.956785-34.515095c-4.659113-12.329816-18.430768-18.544355-30.764678-13.889335-12.329816 4.660136-18.548448 18.433838-13.889335 30.764678 14.776542 39.1036 52.798507 65.375963 94.609775 65.375963 27.693736 0 53.717436-11.533684 72.432683-30.679743 18.71627 19.146059 44.73997 30.679743 72.432683 30.679743 27.160593 0 52.711526-11.093662 71.339792-29.579689 18.629289 18.486026 44.182268 29.579689 71.342862 29.579689 41.809221 0 79.82914-26.272363 94.607728-65.375963C767.751848 727.389582 761.535263 713.614857 749.2034 708.954721z'
  ,'path://M363.648 52.928C244.416 385.792 0 526.016 0 703.104 0 880.384 162.816 1024 363.648 1024s363.584-143.616 363.584-320.896C727.168 526.016 401.088 59.776 363.648 52.928M1020.608 243.392C1002.88 169.408 819.904 0 803.52 0c-16.448 148.352-104.576 226.048-86.784 300.096s100.16 121.344 184.128 105.728C984.704 390.208 1038.4 317.504 1020.608 243.392'
  ,'path://M64 298.666667l245.333333 0 132.266667 162.133333 27.733333-34.133333-134.4-164.266667 0 0C332.8 260.266667 326.4 256 320 256L64 256c-12.8 0-21.333333 8.533333-21.333333 21.333333C42.666667 290.133333 51.2 298.666667 64 298.666667zM889.6 646.4C885.333333 642.133333 881.066667 640 874.666667 640c-12.8 0-21.333333 8.533333-21.333333 21.333333 0 6.4 2.133333 10.666667 6.4 14.933333l49.066667 49.066667-194.133333 0-132.266667-162.133333-27.733333 34.133333 134.4 164.266667 0 0c4.266667 4.266667 10.666667 8.533333 17.066667 8.533333l204.8 0-49.066667 49.066667C855.466667 821.333333 853.333333 825.6 853.333333 832c0 12.8 8.533333 21.333333 21.333333 21.333333 6.4 0 10.666667-2.133333 14.933333-6.4l85.333333-85.333333c4.266667-4.266667 6.4-8.533333 6.4-14.933333 0-6.4-2.133333-10.666667-6.4-14.933333L889.6 646.4zM908.8 298.666667l-49.066667 49.066667C855.466667 352 853.333333 356.266667 853.333333 362.666667c0 12.8 8.533333 21.333333 21.333333 21.333333 6.4 0 10.666667-2.133333 14.933333-6.4l85.333333-85.333333c4.266667-4.266667 6.4-8.533333 6.4-14.933333 0-6.4-2.133333-10.666667-6.4-14.933333l-85.333333-85.333333C885.333333 172.8 881.066667 170.666667 874.666667 170.666667c-12.8 0-21.333333 8.533333-21.333333 21.333333 0 6.4 2.133333 10.666667 6.4 14.933333l49.066667 49.066667L704 256c-6.4 0-12.8 4.266667-17.066667 8.533333l0 0L309.333333 725.333333 64 725.333333c-12.8 0-21.333333 8.533333-21.333333 21.333333 0 12.8 8.533333 21.333333 21.333333 21.333333l256 0c6.4 0 12.8-4.266667 17.066667-8.533333l0 0L714.666667 298.666667 908.8 298.666667z'
  ,'path://M550.820983 617.907039l-9.138563-4.043277L541.68242 273.878529c0-14.228732-18.134879-26.249063-39.598733-26.249063-21.4659 0-39.599756 12.021355-39.599756 26.249063l0 339.986257-9.138563 4.043277c-43.64201 19.312761-71.840564 62.615017-71.840564 110.3177 0 66.488416 54.09149 120.579907 120.578883 120.579907 66.488416 0 120.579907-54.09149 120.579907-120.579907C622.664617 680.522055 594.464016 637.2198 550.820983 617.907039z M674.39318 545.595731l-4.821027-4.544721L669.572154 175.275177c0-35.766267-18.652697-70.39968-51.175951-95.021608-31.302391-23.697838-72.610128-36.748688-116.312515-36.748688-43.703411 0-85.011147 13.05085-116.314562 36.748688-32.522231 24.620905-51.174928 59.254318-51.174928 95.021608l0 365.776857-4.820003 4.544721C279.71063 592.79083 250.998351 659.357021 250.998351 728.225762c0 67.067635 26.11705 130.120648 73.541381 177.544979 47.424331 47.424331 110.478367 73.541381 177.544979 73.541381 67.067635 0 130.121671-26.11705 177.546002-73.541381s73.541381-110.477343 73.541381-177.544979C753.172094 659.357021 724.457768 592.79083 674.39318 545.595731zM502.083687 938.378933c-115.877589 0-210.152148-94.273536-210.152148-210.152148 0-62.79308 27.768746-121.80998 76.185731-161.918343l7.410116-6.138085 0-384.894157c0-24.671049 14.479454-48.65031 39.726652-65.787418 23.79608-16.15264 54.631822-25.048667 86.828626-25.048667 32.195781 0 63.032545 8.896028 86.827603 25.048667 25.246175 17.138131 39.726652 41.116369 39.726652 65.787418l0 384.893133 7.409092 6.138085c48.419032 40.109387 76.189824 99.126286 76.189824 161.919367C712.237882 844.104374 617.963323 938.378933 502.083687 938.378933z M717.924667 201.768822l39.045098 0c8.858163 0 16.038024-5.821868 16.038024-13.004799s-7.179861-13.004799-16.038024-13.004799l-39.045098 0c-8.856117 0-16.035977 5.821868-16.035977 13.004799S709.067527 201.768822 717.924667 201.768822z'
  ,'path://M983.04 617.984l-69.12 0 0-353.792c0-99.328-73.216-176.64-166.4-176.64l-483.328 0c-91.648 0-166.4 74.752-166.4 166.4l0 364.032-58.88 0c-16.896 0-30.72 13.824-30.72 30.72 0 16.896 13.824 30.72 30.72 30.72l143.872 0 0 225.792c0 16.896 13.824 30.72 30.72 30.72 16.896 0 30.72-13.824 30.72-30.72l0-225.792 225.792 0 0 225.792c0 16.896 13.824 30.72 30.72 30.72s30.72-13.824 30.72-30.72l0-225.792 225.792 0 0 225.792c0 16.896 13.824 30.72 30.72 30.72s30.72-13.824 30.72-30.72l0-225.792L983.04 679.424c16.896 0 30.72-13.824 30.72-30.72C1013.76 631.808 999.936 617.984 983.04 617.984zM159.232 253.952c0-57.856 47.104-104.96 104.96-104.96l483.328 0c59.904 0 104.96 49.664 104.96 115.2l0 353.792-693.248 0L159.232 253.952z M413.696 445.44c-10.752-4.096-22.528 1.024-26.624 11.776-8.704 23.04-31.744 38.912-56.32 38.912-33.28 0-59.904-27.136-59.904-59.904l0-109.056c0-33.28 27.136-59.904 59.904-59.904 23.04 0 44.032 13.312 54.272 34.304 5.12 10.24 17.408 14.336 27.648 9.728 10.24-5.12 14.336-17.408 9.728-27.648-16.896-34.816-52.736-57.344-91.136-57.344-55.808 0-101.376 45.568-101.376 101.376L229.888 435.712c0 55.808 45.568 101.376 101.376 101.376 41.472 0 79.36-26.112 94.72-65.024C429.568 461.312 423.936 449.536 413.696 445.44z M545.28 225.28c-54.272 0-98.816 44.032-98.816 98.304l0 114.176c0 54.272 44.032 98.304 98.816 98.304s98.816-44.032 98.816-98.304l0-114.176C643.584 269.824 599.552 225.28 545.28 225.28zM602.624 438.272c0 31.744-25.6 57.344-57.344 57.344s-57.344-25.6-57.344-57.344l0-114.176c0-31.744 25.6-57.344 57.344-57.344s57.344 25.6 57.344 57.344L602.624 438.272z M760.832 500.736l-34.304 0c4.608-5.632 10.24-12.288 18.432-20.48 35.84-27.648 40.96-60.928 33.28-82.944-7.68-22.528-27.648-36.864-51.2-36.864-19.456 0-31.232 8.192-37.376 15.36-16.384 17.92-14.848 44.544-14.336 47.616 1.024 11.264 10.24 19.456 22.016 18.432 11.264-1.024 19.456-10.752 18.944-22.016-0.512-4.608 0.512-12.8 4.096-16.384 0.512-0.512 2.048-2.048 7.168-2.048 6.144 0 10.752 3.072 12.288 8.704 3.072 8.192-1.024 23.552-20.48 37.888-1.024 0.512-1.536 1.024-2.048 2.048-34.304 34.816-48.64 59.904-43.008 76.8 2.56 8.704 10.752 14.336 19.456 14.336l67.584 0c11.264 0 20.48-9.216 20.48-20.48S772.608 500.736 760.832 500.736z'
  ,'path://M332.549371 441.529159C264.875349 546.195053 169.106286 705.322198 169.106286 768.796899c0 98.182266 98.211932 98.182266 98.211932 98.182266l229.060923 0 0.031712 0 229.056831 0c0 0 98.184312 0 98.184312-98.182266 0-63.475724-95.724052-222.602869-163.398074-327.268763L332.549371 441.528136z M594.561407 343.346893 594.561407 114.253235l32.722989 0L627.284396 81.527177l-32.722989 0-98.183289 0-98.181243 0-32.728104 0 0 32.726058 32.728104 0 0 229.093658c0 0-229.090589 327.269786-229.090589 425.451029 0 98.182266 98.181243 98.182266 98.181243 98.182266l229.090589 0 229.088543 0c0 0 98.184312 0 98.184312-98.182266C823.650973 670.616679 594.561407 343.346893 594.561407 343.346893M725.467684 834.25413 496.378118 834.25413 267.287528 834.25413c-10.897774 0-65.453139-3.197826-65.453139-65.456208 0-63.983121 136.898877-283.419876 223.191081-406.692699l5.897463-8.469227 0-10.289103L430.922933 114.253235l130.908324 0 0 229.093658 0 10.289103 5.930198 8.469227c86.259469 123.2718 223.163461 342.709578 223.163461 406.692699C790.924915 828.597067 740.649686 833.99634 725.467684 834.25413'
  ,'path://M696.61723 397.512503 696.61723 292.304346c0-24.841781-20.329001-45.171806-45.171806-45.171806L138.303414 247.13254c-24.828478 0-45.158503 20.330024-45.158503 45.171806l0 436.041004c0 24.829502 20.331048 45.158503 45.158503 45.158503l513.143033 0c24.841781 0 45.171806-20.329001 45.171806-45.158503L696.618253 624.491027l0.014326 1.419326 236.148371 110.704334L932.780951 285.802258 696.61723 397.512503z'
];

var senser1_local = [
  [106.3, 31.3],
  [106, 30.9],
  [106.5, 30.9],
  [107, 30.9],
  [107.5, 30.9],
  [108, 30.9],
  [108.5, 30.9],
  [109, 30.9],
  [109.5, 30.9],
  [110, 30.9],
  [110.5, 30.9],
  [111, 30.9],
  [111.5, 30.9],
  [112, 30.9],
  [112.5, 30.9],
  [113, 30.9],
  [113.5, 30.9],
  [113.5, 30.4],
  [113, 30.4],
  [112.5, 30.4],
  [112, 30.4],
  [111.5, 30.4],
  [111, 30.4],
  [110.5, 30.4],
  [110, 30.4],
  [109.5, 30.4],
  [109, 30.4],
  [108.5, 30.4],
  [108, 30.4],
  [107.5, 30.4],
  [107, 30.4],
  [106.5, 30.4],
  [106, 30.4]
];
var useflag_des = [
  '禁用',
  '启用'
]
var senser2_local = [
  [106.3, 29.8],
  [106, 29.3],
  [106.5, 29.3],
  [107, 29.3],
  [107.5, 29.3],
  [108, 29.3],
  [108.5, 29.3],
  [109, 29.3],
  [109.5, 29.3],
  [110, 29.3],
  [110.5, 29.3],
  [111, 29.3],
  [111.5, 29.3],
  [112, 29.3],
  [112.5, 29.3],
  [113, 29.3],
  [113.5, 29.3],
  [113.5, 28.8],
  [113, 28.8],
  [112.5, 28.8],
  [112, 28.8],
  [111.5, 28.8],
  [111, 28.8],
  [110.5, 28.8],
  [110, 28.8],
  [109.5, 28.8],
  [109, 28.8],
  [108.5, 28.8],
  [108, 28.8],
  [107.5, 28.8],
  [107, 28.8],
  [106.5, 28.8],
  [106, 28.8]
];

    var planePath = 'path://M496.526 952.17v-652.298c-28.624 31.435-47.296 47.081-72.751 48.687 43.883-71.487 66.727-164.415 88.207-276.73 20.583 112.318 45.692 201.141 88.24 276.73-27.666-4.832-44.37-17.856-74.804-49.665v653.278h-28.897z';

    option = {
        backgroundColor: '#fff',
        title: {
            text: '网络拓扑',
            left: '-5',
            top: '10px',
            textStyle: {
                color: '#ffffff',
                fontFamily: '微软雅黑',
                fontWeight: 'lighter',
                fontSize: 18
            }
        },
        tooltip: {
            trigger: 'item',
            formatter: function(o) {
              if(o.value!= undefined && o.value.length>4 ){
                return "地址:" + o.value[2] + "<br>类型:"+o.value[8] + "<br>网关ID:"+o.value[4]+ "<br>传感器ID:"+o.value[5] + "<br>名称:"+o.value[6] + "<br> 启用标示:"+useflag_des[o.value[7]];
              }else{
                return o.name ;
              }

            }
        },
        geo: {
            map: 'china',
            zoom: 16,
            center: [110, 30],
            label: {
                emphasis: {
                    show: false
                }
            },
            roam: true,
            itemStyle: {
                normal: {
                    color: '#fff',
                    areaColor: '#fff',
                    borderColor: '#fff'
                },
                emphasis: {
                    color: '#fff',
                    areaColor: '#fff',
                    borderColor: '#fff'
                }
            }

        },
        series: [ {

            type: 'lines',
            zlevel: 2,
            effect: {
                show: true,
                period: 3,
                trailLength: 0,
                symbol: planePath,
                symbolSize: 15
            },
            lineStyle: {
                normal: {
                    color: '#a6c84c',
                    width: 1,
                    opacity: 0.4,
                    curveness: 0.2
                }
            },
            data: []
        }, {

            type: 'effectScatter',
            coordinateSystem: 'geo',
            zlevel: 2,
            rippleEffect: {
                period: 4,
                scale: 1,
                brushType: 'stroke'
            },
            label: {
                normal: {
                    show: true,
                    position: 'bottom',
                  //  formatter: '1ss'
                    formatter: function(o) {
                      if(o.value.length>4){
                        return o.name+"\r\n地址:" + o.value[2] + "\r\n"+o.value[8] + "\r\n"+o.value[9]  ;
                      }else{
                        return o.name ;
                      }

                    }
                }
            },

            symbolSize: '32',
            itemStyle: {
                normal: {
                    color: '#388E3C',
                }
            },
            data: []
        }]
    };
    var gwparams = parent.document.getElementById("house_gateway_sensor_panel1");

    var params = {};
    params.gwid = gwparams.getAttribute('gatewayid');
    var itemstyles = [
  {
      normal: {
          color: 'red',
      }
  },{}
] ;


  var drowmap = function () {
    $.ajax({
                cache: false,
                type: "GET",
                url: '/gh/sys/user/gh10_house_gateway_sensor_r.action',
                data: {'params':JSON.stringify(params)},
                async: true,
                error: function(frm, action) {


                },
                success: function(frm, action) {
                     var json = JSON.parse(frm);
                    if (json.status == 200) {
                        makerarrey = json.rows;
                        var conver_res = convertData(makerarrey);
                        var gateway1 = conver_res[0].gateway1;
                        var gateway2 = conver_res[0].gateway2;

                        var data = [];
                        var linedata = [];

                        if(gateway1.length > 0 ){
                          data.push({
                               name:gateway1[0][13],
                               value: senser1_local[0].concat(gateway1[0][2]).concat(gateway1[0][13]),
                               symbol:svgpath[0]
                           });
                        }
                        gateway1.forEach(function(marker,i) {
                          linedata.push(
                            {
                              coords:[senser1_local[i+1],senser1_local[i]]
                            }
                          );
                          data.push({
                               name:marker[4],
                               value: senser1_local[i+1].concat(marker),
                               symbol:svgpath[marker[1]],
                               itemStyle:itemstyles[marker[5]]
                           });
                        });
                        if(gateway2.length > 0 ){
                          data.push({
                               name:gateway2[0][13],
                               value: senser2_local[0].concat(gateway2[0][2]).concat(gateway2[0][2]),
                               symbol:svgpath[0]
                           });
                        }
                        gateway2.forEach(function(marker,i) {
                          linedata.push(
                            {
                              coords:[senser2_local[i+1],senser2_local[i]]
                            }
                          );
                          data.push({
                               name:marker[4],
                               value: senser2_local[i+1].concat(marker),
                               symbol:svgpath[marker[1]],
                               itemStyle:itemstyles[marker[5]]
                           });
                        });
                        option.series[0].data = linedata;
                        option.series[1].data = data;
                        myChart.setOption(option, true);
                    }

                }
            });
  };
  drowmap();
/*if (option && typeof option === "object") {
    myChart.setOption(option, true);
}*/

       </script>
   </body>
</html>
